import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CollectionUtils, DependentUtils } from '../../../utility';
import { Ability } from '@casl/ability';
import { AbilityUtils } from '../../../utility/ability.utility';
export class CrudFormComponent {
    constructor(ability) {
        this.ability = ability;
        this.onFormChange = new EventEmitter();
        this.onFieldChange = new EventEmitter();
        this.onButtonClick = new EventEmitter();
        this.onSortClick = new EventEmitter();
        this.onPageClick = new EventEmitter();
        this.formsConfigToDisplay = new Array();
        this.rowsInTab = new Array();
        AbilityUtils.setAbility(this.ability);
    }
    ngOnInit() {
        this.filterForms();
        this.drawTabs();
        this.setConfigAsPerTab();
        this.addWidget = this.addWidgetButton("addWidget", "Add", "add", "primary" /* PRIMARY */);
    }
    setConfigAsPerTab(tabIdentifier) {
        if (this.configData) {
            this.badges = this.configData.badges;
            this.pageBackRoute = this.configData.pageBackRoute;
            this.record = this.configData.record;
            if (this.configData.configPerTabs) {
                let tabIndex = 0;
                this.configData.configPerTabs.forEach((tabConfigData, tabKey) => {
                    if ((tabKey == tabIdentifier || (tabIndex == 0 && tabIdentifier == null)) && tabConfigData) {
                        if (tabConfigData.badges) {
                            this.badges = tabConfigData.badges;
                        }
                        if (tabConfigData.pageBackRoute) {
                            this.pageBackRoute = tabConfigData.pageBackRoute;
                        }
                        if (tabConfigData.record) {
                            this.record = this.configData.record;
                        }
                    }
                    tabIndex++;
                });
            }
        }
    }
    getTabIdentifier(tabTitle) {
        let tabIdentifier = '';
        if (this.form && this.form.tabs) {
            for (let tab of this.form.tabs) {
                if (tab.label == tabTitle) {
                    tabIdentifier = tab.identifier;
                    break;
                }
            }
        }
        return tabIdentifier;
    }
    drawTabs() {
        if (this.form && this.form.tabs && this.form.tabs.length > 0) {
            for (let tIndex = 0; tIndex < this.form.tabs.length; tIndex++) {
                if (this.form.tabs[tIndex] && (this.form.tabs[tIndex].permission == null || (this.form.tabs[tIndex].permission && (this.ability.can(this.form.tabs[tIndex].permission['action'], this.form.tabs[tIndex].permission['subject']))))) {
                    this.rowsInTab.push(this.drawTab(tIndex));
                }
            }
        }
    }
    drawTab(tabIndex) {
        let rows = new Array();
        let rIndex = 0;
        if (this.form && this.form.tabs && this.form.tabs.length > 0) {
            for (let tIndex = 0; tIndex < this.form.tabs.length; tIndex++) {
                if (this.form.tabs[tIndex].widgets && this.form.tabs[tIndex].widgets.length > 0 && tIndex == tabIndex) {
                    for (let widget of this.form.tabs[tIndex].widgets) {
                        if (widget &&
                            (widget.permission == null ||
                                (widget.permission && (this.ability.can(widget.permission['action'], widget.permission['subject']))))) {
                            if (CollectionUtils.isEmpty(rows[rIndex])) {
                                rows[rIndex] = new Array();
                            }
                            let colCount = 0;
                            rows[rIndex].forEach(row => colCount += row.colSpan);
                            if (colCount < 2) {
                                rows[rIndex].push(widget);
                            }
                            else {
                                rIndex++;
                                rows[rIndex] = new Array();
                                rows[rIndex].push(widget);
                            }
                        }
                    }
                }
            }
        }
        console.log(rows);
        return rows;
    }
    displayWidget(widget, supportingRecord, record) {
        return DependentUtils.displayDependencyField(widget.dependentOnFields, supportingRecord, record);
    }
    filterForms() {
        let formIdentifiers;
        if (this.actionPages && this.actions) {
            for (let actionPage of this.actionPages) {
                for (let action of this.actions) {
                    if (actionPage.buttonIdentifier == action.identifier) {
                        formIdentifiers = actionPage.associatedFormIdentifiers;
                    }
                }
            }
            if (this.form && this.form.tabs && formIdentifiers) {
                for (let tab of this.form.tabs) {
                    for (let widget of tab.widgets) {
                        if (formIdentifiers.indexOf(widget.widget.identifier) > -1) {
                            widget.widget['display'] = true;
                        }
                    }
                }
            }
            else {
                this.form.tabs.forEach(tab => tab.widgets.forEach(widget => widget.widget['display'] = true));
            }
        }
        else {
            this.form.tabs.forEach(tab => tab.widgets.forEach(widget => widget.widget['display'] = true));
        }
    }
    addWidgetButton(identifier, label, icon, color) {
        let buttonConfig = {
            identifier: identifier,
            type: "GHOST" /* GHOST */,
            label: label,
            color: color,
            size: "small" /* SMALL */,
            icon: icon,
            onlyIcon: false,
            alwaysEnable: true
        };
        return buttonConfig;
    }
    fieldChange(fieldChange) {
        console.log(fieldChange);
        this.onFieldChange.emit(fieldChange);
    }
    formChange(form) {
        this.onFormChange.emit(form);
    }
    buttonClick(action) {
        console.log(action);
        if (action.action == "addWidget") {
            if (this.record[action.sourceIdentifier] && this.record[action.sourceIdentifier] instanceof Array) {
                this.record[action.sourceIdentifier].push({});
            }
            else {
                this.record[action.sourceIdentifier] = new Array();
                this.record[action.sourceIdentifier].push({});
            }
        }
        this.onButtonClick.emit(action);
    }
    onTabChange(event) {
        console.log(event);
        this.setConfigAsPerTab(this.getTabIdentifier(event.tab.textLabel));
    }
    onAccordianChange(event) {
        console.log(event);
    }
    onSort(event) {
        console.log(event);
        this.onSortClick.emit(event);
    }
    onPage(event) {
        console.log(event);
        this.onPageClick.emit(event);
    }
}
CrudFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'cf-crud-form',
                template: "<mat-card class=\"cf-crud-card\">\n    <!-- {{configData | json}} -->\n    <mat-card-header class=\"cf-list-header\">\n        <cf-crud-header\n            [identifier]=\"identifier\"\n            [title]=\"header.title\"\n            [subtitle]=\"header.subtitle\"\n            [description]=\"header.description\"\n            [badges]=\"badges\"\n            [icon]=\"header.icon\"\n            [pageBackRoute]=\"pageBackRoute\"\n            [formDisplayMode]=\"'CRUD_FORM'\"\n            [actions]=\"actions\"\n            [originalData]=\"configData.originalData\"  \n            [context]=\"record\"\n            [style.width.%]=\"100\"\n            (onButtonClick)=\"buttonClick($event)\"\n        ></cf-crud-header>\n    </mat-card-header> \n  \n    <mat-card-content class=\"cf-crud-content\">\n        <div class=\"mdc-layout-grid cf-crud-header\" *ngIf=\"header.description && header.description.text && header.description.bgColor\">\n            <div class=\"mdc-layout-grid__inner\">\n                <div class=\"mdc-layout-grid__cell--span-12\">\n                    <div \n                        class=\"cf-crud-header-desc\"\n                        [style.background-color]=\"header.description.bgColor\"\n                        [style.color]=\"header.description.textColor\"\n                    >\n                        <mat-icon class=\"cf-crud-header-desc-icon\" aria-hidden=\"true\" [attr.aria-label]=\"header.description.icon\" *ngIf=\"header.description.icon\">{{header.description.icon}}</mat-icon>\n                        <span>{{ header.description.text }}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <!-- <cf-error></cf-error> -->\n\n        <span *ngIf=\"form && form.displayType == 'TAB' && form.tabs && form.tabs.length > 1\">\n            <mat-tab-group (selectedTabChange)=\"onTabChange($event)\">\n              <mat-tab \n                *ngFor=\"let tab of form.tabs; let tIndex=index\"\n                [label]=\"tab.label\">\n                <ng-container *ngTemplateOutlet=\"cfTab; context: {tab: tab, record: record, formRows: rowsInTab[tIndex], tIndex: tIndex}\"></ng-container>\n              </mat-tab>\n            </mat-tab-group>\n        </span>\n        <span *ngIf=\"form && form.displayType == 'ACCORDIAN' && form.tabs && form.tabs.length > 1\">\n            <mat-accordion>\n                <mat-expansion-panel\n                  *ngFor=\"let tab of form.tabs; let tIndex=index\"\n                  [expanded]=\"tIndex === 0\"\n                  (opened)=\"onAccordianChange(tIndex)\">\n                  <mat-expansion-panel-header>\n                    <mat-panel-title>\n                      {{tab.label}}\n                    </mat-panel-title>\n                  </mat-expansion-panel-header>\n                  <ng-container *ngTemplateOutlet=\"cfTab; context: {tab: tab, record: record, formRows: rowsInTab[tIndex], tIndex: tIndex}\"></ng-container>\n                </mat-expansion-panel>\n            </mat-accordion>\n        </span>\n        <span *ngIf=\"form && form.tabs && form.tabs.length == 1\">\n            <span \n                *ngFor=\"let tab of form.tabs; let tIndex=index\">\n                <ng-container *ngTemplateOutlet=\"cfTab; context: {tab: tab, record: record, formRows: rowsInTab[tIndex], tIndex: tIndex}\"></ng-container>\n            </span>\n        </span>\n    </mat-card-content>\n</mat-card>\n  \n<ng-template #cfTab let-tab=\"tab\" let-record=\"record\" let-formRows=\"formRows\" let-tIndex=\"tIndex\">\n    <!-- {{record | json}} -->\n    <div \n        class=\"mdc-layout-grid cf-crud-tab\"\n        *ngIf=\"tab && (tab.permission == null || (tab.permission && (tab.permission['subject'] | can: tab.permission['action'])))\"\n    >\n        <div class=\"mdc-layout-grid__inner cf-crud-tab-header\" *ngIf=\"tab.description && tab.description.text\">\n            <div class=\"mdc-layout-grid__cell--span-12\">\n                {{tab.description.text}} \n            </div>\n        </div>\n\n        <div class=\"mdc-layout-grid__inner\" *ngIf=\"tab.customPlugin && tab.customPlugin.component\">\n            <div class=\"mdc-layout-grid__cell--span-12\">\n                <!-- <ndc-dynamic\n                    [ndcDynamicComponent]=\"tab.customPlugin.component\"\n                ></ndc-dynamic> -->\n            </div>\n        </div>\n\n        <div \n            *ngFor=\"let row of formRows; let rIndex = index;\" \n            class=\"mdc-layout-grid__inner cf-crud-tab-form\"> \n            <div\n                *ngFor=\"let cell of row\" \n                class=\"mdc-layout-grid__cell--span-{{cell.colSpan * 6}} cf-crud-form\">\n                <!-- <pre>--{{configData.record[cell.widget.identifier] | json}}--</pre> -->\n\n                <span *ngIf=\"cell.multiple && cell.multiple.addMore; else singleCell\">\n                    <mat-card  *ngIf=\"displayWidget(cell, record, record[cell.widget.identifier] && record[cell.widget.identifier][0] ? record[cell.widget.identifier][0] : {})\" class=\"cf-crud-child-widgets\">\n                        <!-- {{configData | json}} -->\n                        <mat-card-header class=\"cf-list-header\"> \n                            <mat-card-title>{{ cell.multiple.sectionTitle }}</mat-card-title>\n                            <cf-button \n                                class=\"cf-crud-widget-addmore\"\n                                [sourceIdentifier]=\"cell.widget.identifier\"\n                                [sourceIndex]=\"rIndex\" \n                                [context]=\"record\"\n                                [originalData]=\"configData.record[cell.widget.identifier]\"\n                                [button]=\"addWidget\"\n                                (onClick)=\"buttonClick($event);$event.event.stopPropagation()\"\n                            ></cf-button> \n                        </mat-card-header> \n                        <mat-divider class=\"cf-crud-form-header-divider\"></mat-divider>\n                        <mat-card-content class=\"cf-crud-child-widgets-content\">\n                            <span *ngIf=\"record[cell.widget.identifier] && record[cell.widget.identifier].length > 0; else newCellAtIndex;\">\n                                <span *ngFor=\"let cellAtIndex of record[cell.widget.identifier]; let cellArrayIndex = index;\">\n                                    <ng-container *ngTemplateOutlet=\"cfWidget; context: {\n                                        cell: cell, \n                                        supportingRecord: record,\n                                        record: record[cell.widget.identifier][cellArrayIndex], \n                                        configData: configData.record[cell.widget.identifier][cellArrayIndex], \n                                        multiple: true,\n                                        cellArrayIndex: cellArrayIndex,\n                                        tIndex: tIndex\n                                    }\"></ng-container>\n                                </span>\n                            </span>\n                            <ng-template #newCellAtIndex>\n                                <ng-container *ngTemplateOutlet=\"cfWidget; context: {\n                                    cell: cell, \n                                    supportingRecord: {},\n                                    record: {}, \n                                    configData: {}, \n                                    multiple: true,\n                                    cellArrayIndex: 0,\n                                    tIndex: tIndex\n                                }\"></ng-container>\n                            </ng-template>\n                        </mat-card-content>\n                    </mat-card>\n                </span>\n                <ng-template #singleCell>\n                    <span *ngIf=\"displayWidget(cell, record, record[cell.widget.identifier])\">\n                        <ng-container *ngTemplateOutlet=\"cfWidget; context: {\n                            cell: cell, \n                            supportingRecord: record,\n                            record: record[cell.widget.identifier], \n                            configData: configData.record[cell.widget.identifier], \n                            multiple: false,\n                            cellArrayIndex: null,\n                            tIndex: tIndex\n                        }\"></ng-container>\n                    </span>\n                </ng-template>\n            </div>\n        </div>\n    </div>\n</ng-template>\n\n<ng-template #cfWidget let-cell=\"cell\" let-supportingRecord=\"supportingRecord\" let-record=\"record\" let-configData=\"configData\" let-multiple=\"multiple\" let-cellArrayIndex=\"cellArrayIndex\" let-tIndex=\"tIndex\">\n    <cf-form \n        *ngIf=\"cell.widgetType == 'FORM'\"\n        [formConfig]=\"cell.widget\"\n        [sourceIndex]=\"tIndex\"\n        [widgetArrayIndex]=\"cellArrayIndex\"\n        [record]=\"record\"\n        [originalData]=\"configData\"  \n        [keyMap]=\"keyMap\"\n        [reset]=\"reset\" \n        (onFieldChange)=\"fieldChange($event)\"\n        (onFormChange)=\"formChange($event)\"\n        (onButtonClick)=\"buttonClick($event)\"\n    ></cf-form>\n\n    <cf-static-list\n        *ngIf=\"cell.widgetType == 'LIST' && cell.widget.listType == 'STATIC'\"\n        [listConfig]=\"cell.widget\"\n        [sourceIdentifier]=\"identifier\"\n        [sourceIndex]=\"tIndex\"\n        [widgetArrayIndex]=\"cellArrayIndex\"\n        [record]=\"record\"\n        [originalData]=\"configData\"  \n        [keyMap]=\"keyMap\"\n        (onFormChange)=\"formChange($event)\"\n        (onFieldChange)=\"fieldChange($event)\"\n        (onButtonClick)=\"buttonClick($event)\"\n        (onPageChange)=\"onPage($event)\"\n        (onSortChange)=\"onSort($event)\"  \n    ></cf-static-list>\n    <!-- [expanded]=\"_expanded\" -->\n\n    <cf-dynamic-list\n        *ngIf=\"cell.widgetType == 'LIST' && cell.widget.listType == 'DYNAMIC'\"\n        [listConfig]=\"cell.widget\"\n        [sourceIdentifier]=\"identifier\"\n        [sourceIndex]=\"tIndex\"\n        [widgetArrayIndex]=\"cellArrayIndex\"\n        [record]=\"record\"\n        [originalData]=\"configData\"  \n        [keyMap]=\"keyMap\"\n        (onFormChange)=\"formChange($event)\"\n        (onFieldChange)=\"fieldChange($event)\"\n        (onButtonClick)=\"buttonClick($event)\"\n        (onPageChange)=\"onPage($event)\"\n        (onSortChange)=\"onSort($event)\"  \n    ></cf-dynamic-list>\n</ng-template>",
                styles: [":root{--mdc-layout-grid-column-width-desktop:72px;--mdc-layout-grid-column-width-phone:72px;--mdc-layout-grid-column-width-tablet:72px;--mdc-layout-grid-gutter-desktop:24px;--mdc-layout-grid-gutter-phone:16px;--mdc-layout-grid-gutter-tablet:16px;--mdc-layout-grid-margin-desktop:24px;--mdc-layout-grid-margin-phone:16px;--mdc-layout-grid-margin-tablet:16px}@media (min-width:840px){.mdc-layout-grid{box-sizing:border-box;margin:0 auto;padding:24px;padding:var(--mdc-layout-grid-margin-desktop,24px)}}@media (min-width:600px) and (max-width:839px){.mdc-layout-grid{box-sizing:border-box;margin:0 auto;padding:16px;padding:var(--mdc-layout-grid-margin-tablet,16px)}}@media (max-width:599px){.mdc-layout-grid{box-sizing:border-box;margin:0 auto;padding:16px;padding:var(--mdc-layout-grid-margin-phone,16px)}}@media (min-width:840px){.mdc-layout-grid__inner{align-items:stretch;display:flex;flex-flow:row wrap;margin:-12px;margin:calc(var(--mdc-layout-grid-gutter-desktop, 24px)/2*-1)}@supports (display:grid){.mdc-layout-grid__inner{-ms-grid-columns:(minmax(0,1fr))[12];display:-ms-grid;display:grid;grid-gap:24px;grid-gap:var(--mdc-layout-grid-gutter-desktop,24px);grid-template-columns:repeat(12,minmax(0,1fr));margin:0}}}@media (min-width:600px) and (max-width:839px){.mdc-layout-grid__inner{align-items:stretch;display:flex;flex-flow:row wrap;margin:-8px;margin:calc(var(--mdc-layout-grid-gutter-tablet, 16px)/2*-1)}@supports (display:grid){.mdc-layout-grid__inner{-ms-grid-columns:(minmax(0,1fr))[8];display:-ms-grid;display:grid;grid-gap:16px;grid-gap:var(--mdc-layout-grid-gutter-tablet,16px);grid-template-columns:repeat(8,minmax(0,1fr));margin:0}}}@media (max-width:599px){.mdc-layout-grid__inner{align-items:stretch;display:flex;flex-flow:row wrap;margin:-8px;margin:calc(var(--mdc-layout-grid-gutter-phone, 16px)/2*-1)}@supports (display:grid){.mdc-layout-grid__inner{-ms-grid-columns:(minmax(0,1fr))[4];display:-ms-grid;display:grid;grid-gap:16px;grid-gap:var(--mdc-layout-grid-gutter-phone,16px);grid-template-columns:repeat(4,minmax(0,1fr));margin:0}}}@media (min-width:840px){.mdc-layout-grid__cell{box-sizing:border-box;margin:12px;margin:calc(var(--mdc-layout-grid-gutter-desktop, 24px)/2);width:calc(33.33333% - 24px);width:calc(33.33333% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell{-ms-grid-column-span:4;grid-column-end:span 4;margin:0;width:auto}}.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-desktop{width:calc(8.33333% - 24px);width:calc(8.33333% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-desktop{-ms-grid-column-span:1;grid-column-end:span 1;width:auto}}.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-desktop{width:calc(16.66667% - 24px);width:calc(16.66667% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-desktop{-ms-grid-column-span:2;grid-column-end:span 2;width:auto}}.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-desktop{width:calc(25% - 24px);width:calc(25% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-desktop{-ms-grid-column-span:3;grid-column-end:span 3;width:auto}}.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-desktop{width:calc(33.33333% - 24px);width:calc(33.33333% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-desktop{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-desktop{width:calc(41.66667% - 24px);width:calc(41.66667% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-desktop{-ms-grid-column-span:5;grid-column-end:span 5;width:auto}}.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-desktop{width:calc(50% - 24px);width:calc(50% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-desktop{-ms-grid-column-span:6;grid-column-end:span 6;width:auto}}.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-desktop{width:calc(58.33333% - 24px);width:calc(58.33333% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-desktop{-ms-grid-column-span:7;grid-column-end:span 7;width:auto}}.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-desktop{width:calc(66.66667% - 24px);width:calc(66.66667% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-desktop{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-desktop{width:calc(75% - 24px);width:calc(75% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-desktop{-ms-grid-column-span:9;grid-column-end:span 9;width:auto}}.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-desktop{width:calc(83.33333% - 24px);width:calc(83.33333% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-desktop{-ms-grid-column-span:10;grid-column-end:span 10;width:auto}}.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-desktop{width:calc(91.66667% - 24px);width:calc(91.66667% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-desktop{-ms-grid-column-span:11;grid-column-end:span 11;width:auto}}.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-desktop{width:calc(100% - 24px);width:calc(100% - var(--mdc-layout-grid-gutter-desktop, 24px))}@supports (display:grid){.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-desktop{-ms-grid-column-span:12;grid-column-end:span 12;width:auto}}}@media (min-width:600px) and (max-width:839px){.mdc-layout-grid__cell{box-sizing:border-box;margin:8px;margin:calc(var(--mdc-layout-grid-gutter-tablet, 16px)/2);width:calc(50% - 16px);width:calc(50% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell{-ms-grid-column-span:4;grid-column-end:span 4;margin:0;width:auto}}.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-tablet{width:calc(12.5% - 16px);width:calc(12.5% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-tablet{-ms-grid-column-span:1;grid-column-end:span 1;width:auto}}.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-tablet{width:calc(25% - 16px);width:calc(25% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-tablet{-ms-grid-column-span:2;grid-column-end:span 2;width:auto}}.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-tablet{width:calc(37.5% - 16px);width:calc(37.5% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-tablet{-ms-grid-column-span:3;grid-column-end:span 3;width:auto}}.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-tablet{width:calc(50% - 16px);width:calc(50% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-tablet{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-tablet{width:calc(62.5% - 16px);width:calc(62.5% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-tablet{-ms-grid-column-span:5;grid-column-end:span 5;width:auto}}.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-tablet{width:calc(75% - 16px);width:calc(75% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-tablet{-ms-grid-column-span:6;grid-column-end:span 6;width:auto}}.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-tablet{width:calc(87.5% - 16px);width:calc(87.5% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-tablet{-ms-grid-column-span:7;grid-column-end:span 7;width:auto}}.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-tablet{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-tablet{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-tablet{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-tablet{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-tablet{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-tablet{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-tablet{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-tablet{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-tablet{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-tablet, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-tablet{-ms-grid-column-span:8;grid-column-end:span 8;width:auto}}}@media (max-width:599px){.mdc-layout-grid__cell{box-sizing:border-box;margin:8px;margin:calc(var(--mdc-layout-grid-gutter-phone, 16px)/2);width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell{-ms-grid-column-span:4;grid-column-end:span 4;margin:0;width:auto}}.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-phone{width:calc(25% - 16px);width:calc(25% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-1,.mdc-layout-grid__cell--span-1-phone{-ms-grid-column-span:1;grid-column-end:span 1;width:auto}}.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-phone{width:calc(50% - 16px);width:calc(50% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-2,.mdc-layout-grid__cell--span-2-phone{-ms-grid-column-span:2;grid-column-end:span 2;width:auto}}.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-phone{width:calc(75% - 16px);width:calc(75% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-3,.mdc-layout-grid__cell--span-3-phone{-ms-grid-column-span:3;grid-column-end:span 3;width:auto}}.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-4,.mdc-layout-grid__cell--span-4-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-5,.mdc-layout-grid__cell--span-5-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-6,.mdc-layout-grid__cell--span-6-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-7,.mdc-layout-grid__cell--span-7-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-8,.mdc-layout-grid__cell--span-8-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-9,.mdc-layout-grid__cell--span-9-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-10,.mdc-layout-grid__cell--span-10-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-11,.mdc-layout-grid__cell--span-11-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-phone{width:calc(100% - 16px);width:calc(100% - var(--mdc-layout-grid-gutter-phone, 16px))}@supports (display:grid){.mdc-layout-grid__cell--span-12,.mdc-layout-grid__cell--span-12-phone{-ms-grid-column-span:4;grid-column-end:span 4;width:auto}}}.mdc-layout-grid__cell--order-1{order:1}.mdc-layout-grid__cell--order-2{order:2}.mdc-layout-grid__cell--order-3{order:3}.mdc-layout-grid__cell--order-4{order:4}.mdc-layout-grid__cell--order-5{order:5}.mdc-layout-grid__cell--order-6{order:6}.mdc-layout-grid__cell--order-7{order:7}.mdc-layout-grid__cell--order-8{order:8}.mdc-layout-grid__cell--order-9{order:9}.mdc-layout-grid__cell--order-10{order:10}.mdc-layout-grid__cell--order-11{order:11}.mdc-layout-grid__cell--order-12{order:12}.mdc-layout-grid__cell--align-top{align-self:flex-start}@supports (display:grid){.mdc-layout-grid__cell--align-top{-ms-grid-row-align:start;align-self:start}}.mdc-layout-grid__cell--align-middle{-ms-grid-row-align:center;align-self:center}.mdc-layout-grid__cell--align-bottom{align-self:flex-end}@supports (display:grid){.mdc-layout-grid__cell--align-bottom{-ms-grid-row-align:end;align-self:end}}@media (min-width:840px){.mdc-layout-grid--fixed-column-width{width:1176px;width:calc(var(--mdc-layout-grid-column-width-desktop, 72px)*12 + var(--mdc-layout-grid-gutter-desktop, 24px)*11 + var(--mdc-layout-grid-margin-desktop, 24px)*2)}}@media (min-width:600px) and (max-width:839px){.mdc-layout-grid--fixed-column-width{width:720px;width:calc(var(--mdc-layout-grid-column-width-tablet, 72px)*8 + var(--mdc-layout-grid-gutter-tablet, 16px)*7 + var(--mdc-layout-grid-margin-tablet, 16px)*2)}}@media (max-width:599px){.mdc-layout-grid--fixed-column-width{width:368px;width:calc(var(--mdc-layout-grid-column-width-phone, 72px)*4 + var(--mdc-layout-grid-gutter-phone, 16px)*3 + var(--mdc-layout-grid-margin-phone, 16px)*2)}}.mdc-layout-grid--align-left{margin-left:0;margin-right:auto}.mdc-layout-grid--align-right{margin-left:auto;margin-right:0}.cf-crud-card{background-color:transparent}.cf-crud-form{padding-bottom:20px}.cf-crud-tab{padding:0!important}.cf-crud-tab-header{padding:20px 0!important}.cf-crud-tab-form{margin:1px}.cf-crud-header{padding:0}.cf-crud-header-desc{padding:5px 10px;width:auto}.cf-crud-header-desc-icon{font-size:15px;height:15px!important;margin-top:0;padding:0 5px 0 0;width:15px!important}.cf-crud-child-widgets{background-color:#f5f5f5}.cf-crud-child-widgets-content{padding-top:20px}.cf-crud-widget-addmore{margin-top:-8px}.cf-crud-content{padding-top:16px}"]
            },] }
];
CrudFormComponent.ctorParameters = () => [
    { type: Ability }
];
CrudFormComponent.propDecorators = {
    identifier: [{ type: Input }],
    header: [{ type: Input }],
    actions: [{ type: Input }],
    actionPages: [{ type: Input }],
    form: [{ type: Input }],
    reset: [{ type: Input }],
    configData: [{ type: Input }],
    keyMap: [{ type: Input }],
    onFormChange: [{ type: Output }],
    onFieldChange: [{ type: Output }],
    onButtonClick: [{ type: Output }],
    onSortClick: [{ type: Output }],
    onPageClick: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1ZC1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvbml0aW5raGFpdGFuL05pdGluL3N0dWR5L2FuZ3VsYXIvbWF0ZXJpYWwvYWRtaW4tYnVpbGRlci1wbHVnaW4vcHJvamVjdHMvbmd4LW1hdGVyaWFsLXdpZGdldC9zcmMvIiwic291cmNlcyI6WyJsaWIvY3J1ZC9jb21wb25lbnQvY3J1ZC1mb3JtL2NydWQtZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUcvRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBYSxNQUFNLGtCQUFrQixDQUFDO0FBSzlFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBT2hFLE1BQU0sT0FBTyxpQkFBaUI7SUE0QjVCLFlBQW9CLE9BQWdCO1FBQWhCLFlBQU8sR0FBUCxPQUFPLENBQVM7UUFoQjFCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbkMsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ25DLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNqQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFHM0MseUJBQW9CLEdBQWdDLElBQUksS0FBSyxFQUF3QixDQUFDO1FBQ3RGLGNBQVMsR0FBb0MsSUFBSSxLQUFLLEVBQTRCLENBQUM7UUFTakYsWUFBWSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFbkIs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O1NBQ0Y7UUFDRCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQVU7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVuQixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQsaUJBQWlCLENBQUMsS0FBSztRQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBVTtRQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELE1BQU0sQ0FBQyxLQUFVO1FBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMvQixDQUFDOzs7WUE5TkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxjQUFjO2dCQUN4QixzNlVBQXlDOzthQUUxQzs7O1lBUFEsT0FBTzs7O3lCQVNiLEtBQUs7cUJBQ0wsS0FBSztzQkFDTCxLQUFLOzBCQUNMLEtBQUs7bUJBRUwsS0FBSztvQkFFTCxLQUFLO3lCQUNMLEtBQUs7cUJBQ0wsS0FBSzsyQkFFTCxNQUFNOzRCQUNOLE1BQU07NEJBQ04sTUFBTTswQkFDTixNQUFNOzBCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDcnVkSGVhZGVyLCBBY3Rpb25QYWdlLCBDcnVkVGFiLCBDcnVkV2lkZ2V0LCBDcnVkV2lkZ2V0VHlwZSwgQ3J1ZEZvcm1EYXRhLCBDcnVkRm9ybVRhYkRhdGEsIENydWRGb3JtLCBDcnVkU3R5bGUgfSBmcm9tICcuLi8uLi9tb2RlbCc7XG5pbXBvcnQgeyBCYWRnZSwgQnV0dG9uR3JvdXAsIEhvdmVyQnV0dG9uLCBCdXR0b24sIEJ1dHRvbkNvbG9yLCBCdXR0b25UeXBlLCBCdXR0b25TaXplLCBBY3Rpb24gfSBmcm9tICcuLi8uLi8uLi9idXR0b24vbW9kZWwnO1xuaW1wb3J0IHsgQ29sbGVjdGlvblV0aWxzLCBEZXBlbmRlbnRVdGlscywgRm9ybVV0aWxzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbGl0eSc7XG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnLi4vLi4vLi4vZm9ybS9tb2RlbCc7XG5pbXBvcnQgeyBXaXphcmQgfSBmcm9tICcuLi8uLi8uLi93aXphcmQvbW9kZWwnO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gJy4uLy4uLy4uL2xpc3QvbW9kZWwnO1xuaW1wb3J0IHsgRmllbGRDaGFuZ2UsIEtleU1hcCB9IGZyb20gJy4uLy4uLy4uL2ZpZWxkL21vZGVsJztcbmltcG9ydCB7IEFiaWxpdHkgfSBmcm9tICdAY2FzbC9hYmlsaXR5JztcbmltcG9ydCB7IEFiaWxpdHlVdGlscyB9IGZyb20gJy4uLy4uLy4uL3V0aWxpdHkvYWJpbGl0eS51dGlsaXR5JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY2YtY3J1ZC1mb3JtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NydWQtZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NydWQtZm9ybS5jb21wb25lbnQuc2NzcyddIFxufSlcbmV4cG9ydCBjbGFzcyBDcnVkRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGlkZW50aWZpZXI6IHN0cmluZztcbiAgQElucHV0KCkgaGVhZGVyOiBDcnVkSGVhZGVyO1xuICBASW5wdXQoKSBhY3Rpb25zOiBBcnJheTxCdXR0b24gfCBIb3ZlckJ1dHRvbiB8IEJ1dHRvbkdyb3VwPjtcbiAgQElucHV0KCkgYWN0aW9uUGFnZXM6IEFycmF5PEFjdGlvblBhZ2U+O1xuXG4gIEBJbnB1dCgpIGZvcm06IENydWRGb3JtO1xuXG4gIEBJbnB1dCgpIHJlc2V0OiBib29sZWFuO1xuICBASW5wdXQoKSBjb25maWdEYXRhOiBDcnVkRm9ybURhdGE7XG4gIEBJbnB1dCgpIGtleU1hcDogQXJyYXk8S2V5TWFwPjtcblxuICBAT3V0cHV0KCkgb25Gb3JtQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgb25GaWVsZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIG9uQnV0dG9uQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBvblNvcnRDbGljayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIG9uUGFnZUNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGJhY2tCdXR0b246IEJ1dHRvbjtcbiAgZm9ybXNDb25maWdUb0Rpc3BsYXk6IEFycmF5PEZvcm0gfCBMaXN0IHwgV2l6YXJkPiA9IG5ldyBBcnJheTxGb3JtIHwgTGlzdCB8IFdpemFyZD4oKTtcbiAgcm93c0luVGFiOiBBcnJheTxBcnJheTxBcnJheTxDcnVkV2lkZ2V0Pj4+ID0gbmV3IEFycmF5PEFycmF5PEFycmF5PENydWRXaWRnZXQ+Pj4oKTtcblxuICBiYWRnZXM6IEFycmF5PEJhZGdlPjtcbiAgcGFnZUJhY2tSb3V0ZTogQXJyYXk8c3RyaW5nPjtcbiAgcmVjb3JkOiBhbnk7XG5cbiAgYWRkV2lkZ2V0OiBCdXR0b247XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhYmlsaXR5OiBBYmlsaXR5KSB7IFxuICAgIEFiaWxpdHlVdGlscy5zZXRBYmlsaXR5KHRoaXMuYWJpbGl0eSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmZpbHRlckZvcm1zKCk7XG5cbiAgICB0aGlzLmRyYXdUYWJzKCk7XG5cbiAgICB0aGlzLnNldENvbmZpZ0FzUGVyVGFiKCk7XG5cbiAgICB0aGlzLmFkZFdpZGdldCA9IHRoaXMuYWRkV2lkZ2V0QnV0dG9uKFwiYWRkV2lkZ2V0XCIsIFwiQWRkXCIsIFwiYWRkXCIsIEJ1dHRvbkNvbG9yLlBSSU1BUlkpO1xuICB9XG5cbiAgc2V0Q29uZmlnQXNQZXJUYWIodGFiSWRlbnRpZmllcj86IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbmZpZ0RhdGEpIHtcbiAgICAgIHRoaXMuYmFkZ2VzID0gdGhpcy5jb25maWdEYXRhLmJhZGdlcztcbiAgICAgIHRoaXMucGFnZUJhY2tSb3V0ZSA9IHRoaXMuY29uZmlnRGF0YS5wYWdlQmFja1JvdXRlO1xuICAgICAgdGhpcy5yZWNvcmQgPSB0aGlzLmNvbmZpZ0RhdGEucmVjb3JkO1xuXG4gICAgICBpZiAodGhpcy5jb25maWdEYXRhLmNvbmZpZ1BlclRhYnMpIHtcbiAgICAgICAgbGV0IHRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5jb25maWdEYXRhLmNvbmZpZ1BlclRhYnMuZm9yRWFjaCgodGFiQ29uZmlnRGF0YTogQ3J1ZEZvcm1UYWJEYXRhLCB0YWJLZXk6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGlmICgodGFiS2V5ID09IHRhYklkZW50aWZpZXIgfHwgKHRhYkluZGV4ID09IDAgJiYgdGFiSWRlbnRpZmllciA9PSBudWxsKSkgJiYgdGFiQ29uZmlnRGF0YSkge1xuICAgICAgICAgICAgaWYgKHRhYkNvbmZpZ0RhdGEuYmFkZ2VzKSB7XG4gICAgICAgICAgICAgIHRoaXMuYmFkZ2VzID0gdGFiQ29uZmlnRGF0YS5iYWRnZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFiQ29uZmlnRGF0YS5wYWdlQmFja1JvdXRlKSB7XG4gICAgICAgICAgICAgIHRoaXMucGFnZUJhY2tSb3V0ZSA9IHRhYkNvbmZpZ0RhdGEucGFnZUJhY2tSb3V0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YWJDb25maWdEYXRhLnJlY29yZCkge1xuICAgICAgICAgICAgICB0aGlzLnJlY29yZCA9IHRoaXMuY29uZmlnRGF0YS5yZWNvcmQ7IFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0YWJJbmRleCsrO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldFRhYklkZW50aWZpZXIodGFiVGl0bGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IHRhYklkZW50aWZpZXIgPSAnJztcbiAgICBpZiAodGhpcy5mb3JtICYmIHRoaXMuZm9ybS50YWJzKSB7XG4gICAgICBmb3IgKGxldCB0YWIgb2YgdGhpcy5mb3JtLnRhYnMpIHtcbiAgICAgICAgaWYgKHRhYi5sYWJlbCA9PSB0YWJUaXRsZSkge1xuICAgICAgICAgIHRhYklkZW50aWZpZXIgPSB0YWIuaWRlbnRpZmllcjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0YWJJZGVudGlmaWVyO1xuICB9XG5cbiAgZHJhd1RhYnMoKTogdm9pZCB7IFxuICAgIGlmICh0aGlzLmZvcm0gJiYgdGhpcy5mb3JtLnRhYnMgJiYgdGhpcy5mb3JtLnRhYnMubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChsZXQgdEluZGV4ID0gMDsgdEluZGV4IDwgdGhpcy5mb3JtLnRhYnMubGVuZ3RoOyB0SW5kZXgrKykge1xuICAgICAgICBpZiAodGhpcy5mb3JtLnRhYnNbdEluZGV4XSAmJiAodGhpcy5mb3JtLnRhYnNbdEluZGV4XS5wZXJtaXNzaW9uID09IG51bGwgfHwgKHRoaXMuZm9ybS50YWJzW3RJbmRleF0ucGVybWlzc2lvbiAmJiAodGhpcy5hYmlsaXR5LmNhbih0aGlzLmZvcm0udGFic1t0SW5kZXhdLnBlcm1pc3Npb25bJ2FjdGlvbiddLCB0aGlzLmZvcm0udGFic1t0SW5kZXhdLnBlcm1pc3Npb25bJ3N1YmplY3QnXSkpKSkpIHtcbiAgICAgICAgICB0aGlzLnJvd3NJblRhYi5wdXNoKHRoaXMuZHJhd1RhYih0SW5kZXgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuIFxuICBkcmF3VGFiKHRhYkluZGV4OiBudW1iZXIpOiBBcnJheTxBcnJheTxDcnVkV2lkZ2V0Pj4ge1xuICAgIGxldCByb3dzOiBBcnJheTxBcnJheTxDcnVkV2lkZ2V0Pj4gPSBuZXcgQXJyYXk8QXJyYXk8Q3J1ZFdpZGdldD4+KCk7XG4gICAgbGV0IHJJbmRleCA9IDA7XG5cbiAgICBpZiAodGhpcy5mb3JtICYmIHRoaXMuZm9ybS50YWJzICYmIHRoaXMuZm9ybS50YWJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IHRJbmRleCA9IDA7IHRJbmRleCA8IHRoaXMuZm9ybS50YWJzLmxlbmd0aDsgdEluZGV4KyspIHtcbiAgICAgICAgaWYgKHRoaXMuZm9ybS50YWJzW3RJbmRleF0ud2lkZ2V0cyAmJiB0aGlzLmZvcm0udGFic1t0SW5kZXhdLndpZGdldHMubGVuZ3RoID4gMCAmJiB0SW5kZXggPT0gdGFiSW5kZXgpIHtcbiAgICAgICAgICBmb3IgKGxldCB3aWRnZXQgb2YgdGhpcy5mb3JtLnRhYnNbdEluZGV4XS53aWRnZXRzKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHdpZGdldCAmJiBcbiAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgIHdpZGdldC5wZXJtaXNzaW9uID09IG51bGwgfHwgXG4gICAgICAgICAgICAgICAgKHdpZGdldC5wZXJtaXNzaW9uICYmICh0aGlzLmFiaWxpdHkuY2FuKHdpZGdldC5wZXJtaXNzaW9uWydhY3Rpb24nXSwgd2lkZ2V0LnBlcm1pc3Npb25bJ3N1YmplY3QnXSkpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgaWYgKENvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHJvd3NbckluZGV4XSkpIHtcbiAgICAgICAgICAgICAgICByb3dzW3JJbmRleF0gPSBuZXcgQXJyYXk8Q3J1ZFdpZGdldD4oKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGxldCBjb2xDb3VudCA9IDA7XG4gICAgICAgICAgICAgIHJvd3NbckluZGV4XS5mb3JFYWNoKHJvdyA9PiBjb2xDb3VudCArPSByb3cuY29sU3Bhbik7XG5cbiAgICAgICAgICAgICAgaWYgKGNvbENvdW50IDwgMikge1xuICAgICAgICAgICAgICAgIHJvd3NbckluZGV4XS5wdXNoKHdpZGdldCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgckluZGV4Kys7XG4gICAgICAgICAgICAgICAgcm93c1tySW5kZXhdID0gbmV3IEFycmF5PENydWRXaWRnZXQ+KCk7XG4gICAgICAgICAgICAgICAgcm93c1tySW5kZXhdLnB1c2god2lkZ2V0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiBcbiAgICBjb25zb2xlLmxvZyhyb3dzKTtcbiAgICByZXR1cm4gcm93cztcbiAgfVxuXG4gIGRpc3BsYXlXaWRnZXQod2lkZ2V0OiBDcnVkV2lkZ2V0LCBzdXBwb3J0aW5nUmVjb3JkOiBhbnksIHJlY29yZDogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIERlcGVuZGVudFV0aWxzLmRpc3BsYXlEZXBlbmRlbmN5RmllbGQod2lkZ2V0LmRlcGVuZGVudE9uRmllbGRzLCBzdXBwb3J0aW5nUmVjb3JkLCByZWNvcmQpO1xuICB9XG5cbiAgZmlsdGVyRm9ybXMoKSB7XG4gICAgbGV0IGZvcm1JZGVudGlmaWVyczogQXJyYXk8c3RyaW5nPjtcbiAgICBpZiAodGhpcy5hY3Rpb25QYWdlcyAmJiB0aGlzLmFjdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGFjdGlvblBhZ2Ugb2YgdGhpcy5hY3Rpb25QYWdlcykge1xuICAgICAgICBmb3IgKGxldCBhY3Rpb24gb2YgdGhpcy5hY3Rpb25zKSB7XG4gICAgICAgICAgaWYgKGFjdGlvblBhZ2UuYnV0dG9uSWRlbnRpZmllciA9PSBhY3Rpb24uaWRlbnRpZmllcikge1xuICAgICAgICAgICAgZm9ybUlkZW50aWZpZXJzID0gYWN0aW9uUGFnZS5hc3NvY2lhdGVkRm9ybUlkZW50aWZpZXJzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5mb3JtICYmIHRoaXMuZm9ybS50YWJzICYmIGZvcm1JZGVudGlmaWVycykge1xuICAgICAgICBmb3IgKGxldCB0YWIgb2YgdGhpcy5mb3JtLnRhYnMpIHtcbiAgICAgICAgICBmb3IgKGxldCB3aWRnZXQgb2YgdGFiLndpZGdldHMpIHtcbiAgICAgICAgICAgIGlmIChmb3JtSWRlbnRpZmllcnMuaW5kZXhPZigoPEZvcm0+d2lkZ2V0LndpZGdldCkuaWRlbnRpZmllcikgPiAtMSkge1xuICAgICAgICAgICAgICB3aWRnZXQud2lkZ2V0WydkaXNwbGF5J10gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5mb3JtLnRhYnMuZm9yRWFjaCh0YWIgPT4gdGFiLndpZGdldHMuZm9yRWFjaCh3aWRnZXQgPT4gd2lkZ2V0LndpZGdldFsnZGlzcGxheSddID0gdHJ1ZSkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZvcm0udGFicy5mb3JFYWNoKHRhYiA9PiB0YWIud2lkZ2V0cy5mb3JFYWNoKHdpZGdldCA9PiB3aWRnZXQud2lkZ2V0WydkaXNwbGF5J10gPSB0cnVlKSk7XG4gICAgfVxuICB9XG5cbiAgYWRkV2lkZ2V0QnV0dG9uKGlkZW50aWZpZXI6IHN0cmluZywgbGFiZWw6IHN0cmluZywgaWNvbjogc3RyaW5nLCBjb2xvcjogQnV0dG9uQ29sb3IpOiBCdXR0b24ge1xuICAgIGxldCBidXR0b25Db25maWc6IEJ1dHRvbiA9IHtcbiAgICAgIGlkZW50aWZpZXI6IGlkZW50aWZpZXIsXG4gICAgICB0eXBlOiBCdXR0b25UeXBlLkdIT1NULFxuICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgY29sb3I6IGNvbG9yLFxuICAgICAgc2l6ZTogQnV0dG9uU2l6ZS5TTUFMTCxcbiAgICAgIGljb246IGljb24sXG4gICAgICBvbmx5SWNvbjogZmFsc2UsXG4gICAgICBhbHdheXNFbmFibGU6IHRydWVcbiAgICB9XG5cbiAgICByZXR1cm4gYnV0dG9uQ29uZmlnO1xuICB9XG5cbiAgZmllbGRDaGFuZ2UoZmllbGRDaGFuZ2U6IEZpZWxkQ2hhbmdlKSB7XG4gICAgY29uc29sZS5sb2coZmllbGRDaGFuZ2UpO1xuICAgIHRoaXMub25GaWVsZENoYW5nZS5lbWl0KGZpZWxkQ2hhbmdlKTtcbiAgfVxuXG4gIGZvcm1DaGFuZ2UoZm9ybTogYW55KSB7XG4gICAgdGhpcy5vbkZvcm1DaGFuZ2UuZW1pdChmb3JtKTtcbiAgfVxuXG4gIGJ1dHRvbkNsaWNrKGFjdGlvbjogQWN0aW9uKSB7XG4gICAgY29uc29sZS5sb2coYWN0aW9uKTtcbiAgICBpZiAoYWN0aW9uLmFjdGlvbiA9PSBcImFkZFdpZGdldFwiKSAge1xuICAgICAgaWYgKHRoaXMucmVjb3JkW2FjdGlvbi5zb3VyY2VJZGVudGlmaWVyXSAmJiB0aGlzLnJlY29yZFthY3Rpb24uc291cmNlSWRlbnRpZmllcl0gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAoPEFycmF5PGFueT4+dGhpcy5yZWNvcmRbYWN0aW9uLnNvdXJjZUlkZW50aWZpZXJdKS5wdXNoKHt9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVjb3JkW2FjdGlvbi5zb3VyY2VJZGVudGlmaWVyXSA9IG5ldyBBcnJheTxhbnk+KCk7XG4gICAgICAgIHRoaXMucmVjb3JkW2FjdGlvbi5zb3VyY2VJZGVudGlmaWVyXS5wdXNoKHt9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5vbkJ1dHRvbkNsaWNrLmVtaXQoYWN0aW9uKTtcbiAgfVxuXG4gIG9uVGFiQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XG5cbiAgICB0aGlzLnNldENvbmZpZ0FzUGVyVGFiKHRoaXMuZ2V0VGFiSWRlbnRpZmllcihldmVudC50YWIudGV4dExhYmVsKSk7XG4gIH1cblxuICBvbkFjY29yZGlhbkNoYW5nZShldmVudCkge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgfVxuXG4gIG9uU29ydChldmVudDogYW55KSB7XG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xuICAgIHRoaXMub25Tb3J0Q2xpY2suZW1pdChldmVudCk7XG4gIH1cblxuICBvblBhZ2UoZXZlbnQ6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgICB0aGlzLm9uUGFnZUNsaWNrLmVtaXQoZXZlbnQpO1xuICB9XG59XG4iXX0=