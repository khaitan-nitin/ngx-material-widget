import { CollectionUtils } from './collection.utility';
import { FormUtils } from './form.utility';
import { ListUtils } from './list.utility';
export class CrudUtils {
    static setOptionsUsingKey(crud, fieldKey, masterDataKey) {
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.form) && !CollectionUtils.isEmpty(crud.form.tabs)) {
            crud.form.tabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.setOptionsUsingKey(widget.widget, fieldKey, masterDataKey);
                        }
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "LIST" /* LIST */) {
                            ListUtils.setOptionsUsingKey(widget.widget, fieldKey, masterDataKey);
                        }
                    });
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.list) && !CollectionUtils.isEmpty(crud.list.lists)) {
            crud.list.lists.forEach(list => {
                if (!CollectionUtils.isEmpty(list)) {
                    ListUtils.setOptionsUsingKey(list, fieldKey, masterDataKey);
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.search) && !CollectionUtils.isEmpty(crud.search.form)) {
            FormUtils.setOptionsUsingKey(crud.search.form, fieldKey, masterDataKey);
        }
    }
    static setOptionsUsingValues(crud, fieldKey, keyMap, relaodAll, record) {
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.form) && !CollectionUtils.isEmpty(crud.form.tabs)) {
            crud.form.tabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.setOptionsUsingValues(widget.widget, fieldKey, keyMap, relaodAll, record);
                        }
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "LIST" /* LIST */) {
                            ListUtils.setOptionsUsingValues(widget.widget, fieldKey, keyMap, relaodAll, record);
                        }
                    });
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.list) && !CollectionUtils.isEmpty(crud.list.lists)) {
            crud.list.lists.forEach(list => {
                if (!CollectionUtils.isEmpty(list)) {
                    ListUtils.setOptionsUsingValues(list, fieldKey, keyMap, relaodAll, record);
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.search) && !CollectionUtils.isEmpty(crud.search.form)) {
            FormUtils.setOptionsUsingValues(crud.search.form, fieldKey, keyMap, relaodAll, record);
        }
    }
    static setDisplayType(crudTabs, formDisplayMode) {
        if (!CollectionUtils.isEmpty(crudTabs)) {
            crudTabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            widget.widget.displayMode = formDisplayMode;
                        }
                    });
                }
            });
        }
    }
    static changeButtonLabelIcon(crudTabs, buttonIdentifier, label, icon) {
        if (!CollectionUtils.isEmpty(crudTabs)) {
            crudTabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.changeButtonLabelIcon(widget.widget, buttonIdentifier, label, icon);
                        }
                    });
                }
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1ZC51dGlsaXR5LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9uaXRpbmtoYWl0YW4vTml0aW4vc3R1ZHkvYW5ndWxhci9tYXRlcmlhbC9hZG1pbi1idWlsZGVyLXBsdWdpbi9wcm9qZWN0cy9uZ3gtbWF0ZXJpYWwtd2lkZ2V0L3NyYy8iLCJzb3VyY2VzIjpbImxpYi91dGlsaXR5L2NydWQudXRpbGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkzQyxNQUFNLE9BQU8sU0FBUztJQUNwQixNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBVSxFQUFFLFFBQWdCLEVBQUUsYUFBcUI7UUFDM0UsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNySCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQzFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO3dCQUMzQixJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsVUFBVSxxQkFBdUIsRUFBRTs0QkFDaEYsU0FBUyxDQUFDLGtC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QUMsTUFBTSxDQUFDLEVBQUU7d0JBQzNCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxVQUFVLHFCQUF1QixFQUFFOzRCQUN6RSxNQUFNLENBQUMsTUFBTyxDQUFDLFdBQVcsR0FBRyxlQUFlLENBQUM7eUJBQ3JEO29CQUNILENBQUMsQ0FBQyxDQUFBO2lCQUNIO1lBQ0gsQ0FBQyxDQUFDLENBQUE7U0FDSDtJQUNILENBQUM7SUFFRCxNQUFNLENBQUMscUJBQXFCLENBQUMsUUFBd0IsRUFBRSxnQkFBd0IsRUFBRSxLQUFjLEVBQUUsSUFBYTtRQUM1RyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN0QyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNyQixJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUMxRSxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTt3QkFDM0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLFVBQVUscUJBQXVCLEVBQUU7NEJBQ2hGLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBUSxNQUFNLENBQUMsTUFBTyxFQUFFLGdCQUFnQixFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQzt5QkFDdkY7b0JBQ0gsQ0FBQyxDQUFDLENBQUE7aUJBQ0g7WUFDSCxDQUFDLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybSwgRm9ybURpYXBseU1vZGUgfSBmcm9tICcuLi9mb3JtL21vZGVsJztcbmltcG9ydCB7IENvbGxlY3Rpb25VdGlscyB9IGZyb20gJy4vY29sbGVjdGlvbi51dGlsaXR5JztcbmltcG9ydCB7IENydWQsIENydWRXaWRnZXRUeXBlLCBDcnVkVGFiIH0gZnJvbSAnLi4vY3J1ZC9tb2RlbCc7XG5pbXBvcnQgeyBGb3JtVXRpbHMgfSBmcm9tICcuL2Zvcm0udXRpbGl0eSc7XG5pbXBvcnQgeyBMaXN0VXRpbHMgfSBmcm9tICcuL2xpc3QudXRpbGl0eSc7XG5pbXBvcnQgeyBMaXN0IH0gZnJvbSAnLi4vbGlzdC9tb2RlbCc7XG5pbXBvcnQgeyBEcm9wZG93bk9wdGlvbiwgS2V5TWFwIH0gZnJvbSAnLi4vZmllbGQvbW9kZWwnO1xuXG5leHBvcnQgY2xhc3MgQ3J1ZFV0aWxzIHtcbiAgc3RhdGljIHNldE9wdGlvbnNVc2luZ0tleShjcnVkOiBDcnVkLCBmaWVsZEtleTogc3RyaW5nLCBtYXN0ZXJEYXRhS2V5OiBzdHJpbmcpIHtcbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmZvcm0pICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmZvcm0udGFicykpIHtcbiAgICAgIGNydWQuZm9ybS50YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh0YWIpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh0YWIud2lkZ2V0cykpIHtcbiAgICAgICAgICB0YWIud2lkZ2V0cy5mb3JFYWNoKHdpZGdldCA9PiB7XG4gICAgICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHdpZGdldCkgJiYgd2lkZ2V0LndpZGdldFR5cGUgPT0gQ3J1ZFdpZGdldFR5cGUuRk9STSkge1xuICAgICAgICAgICAgICBGb3JtVXRpbHMuc2V0T3B0aW9uc1VzaW5nS2V5KDxGb3JtPndpZGdldC53aWRnZXQsIGZpZWxkS2V5LCBtYXN0ZXJEYXRhS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkod2lkZ2V0KSAmJiB3aWRnZXQud2lkZ2V0VHlwZSA9PSBDcnVkV2lkZ2V0VHlwZS5MSVNUKSB7XG4gICAgICAgICAgICAgIExpc3RVdGlscy5zZXRPcHRpb25zVXNpbmdLZXkoPExpc3Q+d2lkZ2V0LndpZGdldCwgZmllbGRLZXksIG1hc3RlckRhdGFLZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5saXN0KSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5saXN0Lmxpc3RzKSkge1xuICAgICAgY3J1ZC5saXN0Lmxpc3RzLmZvckVhY2gobGlzdCA9PiB7XG4gICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkobGlzdCkpIHtcbiAgICAgICAgICBMaXN0VXRpbHMuc2V0T3B0aW9uc1VzaW5nS2V5KGxpc3QsIGZpZWxkS2V5LCBtYXN0ZXJEYXRhS2V5KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLnNlYXJjaCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuc2VhcmNoLmZvcm0pKSAge1xuICAgICAgRm9ybVV0aWxzLnNldE9wdGlvbnNVc2luZ0tleShjcnVkLnNlYXJjaC5mb3JtLCBmaWVsZEtleSwgbWFzdGVyRGF0YUtleSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIHNldE9wdGlvbnNVc2luZ1ZhbHVlcyhjcnVkOiBDcnVkLCBmaWVsZEtleTogc3RyaW5nLCBrZXlNYXA6IEtleU1hcCwgcmVsYW9kQWxsOiBib29sZWFuLCByZWNvcmQ6IGFueSkge1xuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuZm9ybSkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuZm9ybS50YWJzKSkge1xuICAgICAgY3J1ZC5mb3JtLnRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYikgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYi53aWRnZXRzKSkge1xuICAgICAgICAgIHRhYi53aWRnZXRzLmZvckVhY2god2lkZ2V0ID0+IHtcbiAgICAgICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkod2lkZ2V0KSAmJiB3aWRnZXQud2lkZ2V0VHlwZSA9PSBDcnVkV2lkZ2V0VHlwZS5GT1JNKSB7XG4gICAgICAgICAgICAgIEZvcm1VdGlscy5zZXRPcHRpb25zVXNpbmdWYWx1ZXMoPEZvcm0+d2lkZ2V0LndpZGdldCwgZmllbGRLZXksIGtleU1hcCwgcmVsYW9kQWxsLCByZWNvcmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh3aWRnZXQpICYmIHdpZGdldC53aWRnZXRUeXBlID09IENydWRXaWRnZXRUeXBlLkxJU1QpIHtcbiAgICAgICAgICAgICAgTGlzdFV0aWxzLnNldE9wdGlvbnNVc2luZ1ZhbHVlcyg8TGlzdD53aWRnZXQud2lkZ2V0LCBmaWVsZEtleSwga2V5TWFwLCByZWxhb2RBbGwsIHJlY29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmxpc3QpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmxpc3QubGlzdHMpKSB7XG4gICAgICBjcnVkLmxpc3QubGlzdHMuZm9yRWFjaChsaXN0ID0+IHtcbiAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShsaXN0KSkge1xuICAgICAgICAgIExpc3RVdGlscy5zZXRPcHRpb25zVXNpbmdWYWx1ZXMobGlzdCwgZmllbGRLZXksIGtleU1hcCwgcmVsYW9kQWxsLCByZWNvcmQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuc2VhcmNoKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5zZWFyY2guZm9ybSkpICB7XG4gICAgICBGb3JtVXRpbHMuc2V0T3B0aW9uc1VzaW5nVmFsdWVzKGNydWQuc2VhcmNoLmZvcm0sIGZpZWxkS2V5LCBrZXlNYXAsIHJlbGFvZEFsbCwgcmVjb3JkKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgc2V0RGlzcGxheVR5cGUoY3J1ZFRhYnM6IEFycmF5PENydWRUYWI+LCBmb3JtRGlzcGxheU1vZGU6IEZvcm1EaWFwbHlNb2RlKSB7XG4gICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkVGFicykpIHtcbiAgICAgIGNydWRUYWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh0YWIpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh0YWIud2lkZ2V0cykpIHtcbiAgICAgICAgICB0YWIud2lkZ2V0cy5mb3JFYWNoKHdpZGdldCA9PiB7XG4gICAgICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHdpZGdldCkgJiYgd2lkZ2V0LndpZGdldFR5cGUgPT0gQ3J1ZFdpZGdldFR5cGUuRk9STSkge1xuICAgICAgICAgICAgICAoPEZvcm0+d2lkZ2V0LndpZGdldCkuZGlzcGxheU1vZGUgPSBmb3JtRGlzcGxheU1vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgY2hhbmdlQnV0dG9uTGFiZWxJY29uKGNydWRUYWJzOiBBcnJheTxDcnVkVGFiPiwgYnV0dG9uSWRlbnRpZmllcjogc3RyaW5nLCBsYWJlbD86IHN0cmluZywgaWNvbj86IHN0cmluZykgIHtcbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWRUYWJzKSkge1xuICAgICAgY3J1ZFRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYikgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYi53aWRnZXRzKSkge1xuICAgICAgICAgIHRhYi53aWRnZXRzLmZvckVhY2god2lkZ2V0ID0+IHtcbiAgICAgICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkod2lkZ2V0KSAmJiB3aWRnZXQud2lkZ2V0VHlwZSA9PSBDcnVkV2lkZ2V0VHlwZS5GT1JNKSB7XG4gICAgICAgICAgICAgIEZvcm1VdGlscy5jaGFuZ2VCdXR0b25MYWJlbEljb24oKDxGb3JtPndpZGdldC53aWRnZXQpLCBidXR0b25JZGVudGlmaWVyLCBsYWJlbCwgaWNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0iXX0=