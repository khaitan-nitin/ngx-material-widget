import { CollectionUtils } from './collection.utility';
import { FormUtils } from './form.utility';
import { ListUtils } from './list.utility';
export class CrudUtils {
    static setOptionsUsingKey(crud, fieldKey, masterDataKey) {
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.form) && !CollectionUtils.isEmpty(crud.form.tabs)) {
            crud.form.tabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.setOptionsUsingKey(widget.widget, fieldKey, masterDataKey);
                        }
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "LIST" /* LIST */) {
                            ListUtils.setOptionsUsingKey(widget.widget, fieldKey, masterDataKey);
                        }
                    });
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.list) && !CollectionUtils.isEmpty(crud.list.lists)) {
            crud.list.lists.forEach(list => {
                if (!CollectionUtils.isEmpty(list)) {
                    ListUtils.setOptionsUsingKey(list, fieldKey, masterDataKey);
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.search) && !CollectionUtils.isEmpty(crud.search.form)) {
            FormUtils.setOptionsUsingKey(crud.search.form, fieldKey, masterDataKey);
        }
    }
    static setOptionsUsingValues(crud, fieldKey, keyMap, relaodAll, record) {
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.form) && !CollectionUtils.isEmpty(crud.form.tabs)) {
            crud.form.tabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.setOptionsUsingValues(widget.widget, fieldKey, keyMap, relaodAll, record);
                        }
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "LIST" /* LIST */) {
                            ListUtils.setOptionsUsingValues(widget.widget, fieldKey, keyMap, relaodAll, record);
                        }
                    });
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.list) && !CollectionUtils.isEmpty(crud.list.lists)) {
            crud.list.lists.forEach(list => {
                if (!CollectionUtils.isEmpty(list)) {
                    ListUtils.setOptionsUsingValues(list, fieldKey, keyMap, relaodAll, record);
                }
            });
        }
        if (!CollectionUtils.isEmpty(crud) && !CollectionUtils.isEmpty(crud.search) && !CollectionUtils.isEmpty(crud.search.form)) {
            FormUtils.setOptionsUsingValues(crud.search.form, fieldKey, keyMap, relaodAll, record);
        }
    }
    static setDisplayType(crudTabs, formDisplayMode) {
        if (!CollectionUtils.isEmpty(crudTabs)) {
            crudTabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            widget.widget.displayMode = formDisplayMode;
                        }
                    });
                }
            });
        }
    }
    static changeButtonLabelIcon(crudTabs, buttonIdentifier, label, icon) {
        if (!CollectionUtils.isEmpty(crudTabs)) {
            crudTabs.forEach(tab => {
                if (!CollectionUtils.isEmpty(tab) && !CollectionUtils.isEmpty(tab.widgets)) {
                    tab.widgets.forEach(widget => {
                        if (!CollectionUtils.isEmpty(widget) && widget.widgetType == "FORM" /* FORM */) {
                            FormUtils.changeButtonLabelIcon(widget.widget, buttonIdentifier, label, icon);
                        }
                    });
                }
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1ZC51dGlsaXR5LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9uaXRpbmtoYWl0YW4vTml0aW4vc3R1ZHkvYW5ndWxhci9tYXRlcmlhbC9hZG1pbi1idWlsZGVyLXBsdWdpbi9wcm9qZWN0cy9uZ3gtbWF0ZXJpYWwtd2lkZ2V0L3NyYy8iLCJzb3VyY2VzIjpbImxpYi91dGlsaXR5L2NydWQudXRpbGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkzQyxNQUFNLE9BQU8sU0FBUztJQUNwQixNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBVSxFQUFFLFFBQWdCLEVBQUUsYUFBcUI7UUFDM0UsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNySCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQzFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO3dCQUMzQixJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsVUFBVSxxQkFBdUIsRUFBRTs0QkFDaEYsU0FBUyxDQUFDLGtC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QUMsTUFBTSxDQUFDLEVBQUU7d0JBQzNCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxVQUFVLHFCQUF1QixFQUFFOzRCQUN6RSxNQUFNLENBQUMsTUFBTyxDQUFDLFdBQVcsR0FBRyxlQUFlLENBQUM7eUJBQ3JEO29CQUNILENBQUMsQ0FBQyxDQUFBO2lCQUNIO1lBQ0gsQ0FBQyxDQUFDLENBQUE7U0FDSDtJQUNILENBQUM7SUFFRCxNQUFNLENBQUMscUJBQXFCLENBQUMsUUFBd0IsRUFBRSxnQkFBd0IsRUFBRSxLQUFjLEVBQUUsSUFBYTtRQUM1RyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN0QyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNyQixJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUMxRSxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTt3QkFDM0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLFVBQVUscUJBQXVCLEVBQUU7NEJBQ2hGLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBUSxNQUFNLENBQUMsTUFBTyxFQUFFLGdCQUFnQixFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQzt5QkFDdkY7b0JBQ0gsQ0FBQyxDQUFDLENBQUE7aUJBQ0g7WUFDSCxDQUFDLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybSwgRm9ybURpYXBseU1vZGUgfSBmcm9tICcuLi9mb3JtL21vZGVsJztcbmltcG9ydCB7IENvbGxlY3Rpb25VdGlscyB9IGZyb20gJy4vY29sbGVjdGlvbi51dGlsaXR5JztcbmltcG9ydCB7IENydWQsIENydWRXaWRnZXRUeXBlLCBDcnVkVGFiIH0gZnJvbSAnLi4vY3J1ZC9tb2RlbCc7XG5pbXBvcnQgeyBGb3JtVXRpbHMgfSBmcm9tICcuL2Zvcm0udXRpbGl0eSc7XG5pbXBvcnQgeyBMaXN0VXRpbHMgfSBmcm9tICcuL2xpc3QudXRpbGl0eSc7XG5pbXBvcnQgeyBMaXN0IH0gZnJvbSAnLi4vbGlzdC9tb2RlbCc7XG5pbXBvcnQgeyBLZXlNYXAgfSBmcm9tICcuLi9maWVsZC9tb2RlbCc7XG5cbmV4cG9ydCBjbGFzcyBDcnVkVXRpbHMge1xuICBzdGF0aWMgc2V0T3B0aW9uc1VzaW5nS2V5KGNydWQ6IENydWQsIGZpZWxkS2V5OiBzdHJpbmcsIG1hc3RlckRhdGFLZXk6IHN0cmluZykge1xuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuZm9ybSkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuZm9ybS50YWJzKSkge1xuICAgICAgY3J1ZC5mb3JtLnRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYikgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYi53aWRnZXRzKSkge1xuICAgICAgICAgIHRhYi53aWRnZXRzLmZvckVhY2god2lkZ2V0ID0+IHtcbiAgICAgICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkod2lkZ2V0KSAmJiB3aWRnZXQud2lkZ2V0VHlwZSA9PSBDcnVkV2lkZ2V0VHlwZS5GT1JNKSB7XG4gICAgICAgICAgICAgIEZvcm1VdGlscy5zZXRPcHRpb25zVXNpbmdLZXkoPEZvcm0+d2lkZ2V0LndpZGdldCwgZmllbGRLZXksIG1hc3RlckRhdGFLZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh3aWRnZXQpICYmIHdpZGdldC53aWRnZXRUeXBlID09IENydWRXaWRnZXRUeXBlLkxJU1QpIHtcbiAgICAgICAgICAgICAgTGlzdFV0aWxzLnNldE9wdGlvbnNVc2luZ0tleSg8TGlzdD53aWRnZXQud2lkZ2V0LCBmaWVsZEtleSwgbWFzdGVyRGF0YUtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmxpc3QpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLmxpc3QubGlzdHMpKSB7XG4gICAgICBjcnVkLmxpc3QubGlzdHMuZm9yRWFjaChsaXN0ID0+IHtcbiAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShsaXN0KSkge1xuICAgICAgICAgIExpc3RVdGlscy5zZXRPcHRpb25zVXNpbmdLZXkobGlzdCwgZmllbGRLZXksIG1hc3RlckRhdGFLZXkpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQuc2VhcmNoKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5zZWFyY2guZm9ybSkpICB7XG4gICAgICBGb3JtVXRpbHMuc2V0T3B0aW9uc1VzaW5nS2V5KGNydWQuc2VhcmNoLmZvcm0sIGZpZWxkS2V5LCBtYXN0ZXJEYXRhS2V5KTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgc2V0T3B0aW9uc1VzaW5nVmFsdWVzKGNydWQ6IENydWQsIGZpZWxkS2V5OiBzdHJpbmcsIGtleU1hcDogS2V5TWFwLCByZWxhb2RBbGw6IGJvb2xlYW4sIHJlY29yZDogYW55KSB7XG4gICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5mb3JtKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5mb3JtLnRhYnMpKSB7XG4gICAgICBjcnVkLmZvcm0udGFicy5mb3JFYWNoKHRhYiA9PiB7XG4gICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkodGFiKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkodGFiLndpZGdldHMpKSB7XG4gICAgICAgICAgdGFiLndpZGdldHMuZm9yRWFjaCh3aWRnZXQgPT4ge1xuICAgICAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh3aWRnZXQpICYmIHdpZGdldC53aWRnZXRUeXBlID09IENydWRXaWRnZXRUeXBlLkZPUk0pIHtcbiAgICAgICAgICAgICAgRm9ybVV0aWxzLnNldE9wdGlvbnNVc2luZ1ZhbHVlcyg8Rm9ybT53aWRnZXQud2lkZ2V0LCBmaWVsZEtleSwga2V5TWFwLCByZWxhb2RBbGwsIHJlY29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHdpZGdldCkgJiYgd2lkZ2V0LndpZGdldFR5cGUgPT0gQ3J1ZFdpZGdldFR5cGUuTElTVCkge1xuICAgICAgICAgICAgICBMaXN0VXRpbHMuc2V0T3B0aW9uc1VzaW5nVmFsdWVzKDxMaXN0PndpZGdldC53aWRnZXQsIGZpZWxkS2V5LCBrZXlNYXAsIHJlbGFvZEFsbCwgcmVjb3JkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQubGlzdCkgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWQubGlzdC5saXN0cykpIHtcbiAgICAgIGNydWQubGlzdC5saXN0cy5mb3JFYWNoKGxpc3QgPT4ge1xuICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGxpc3QpKSB7XG4gICAgICAgICAgTGlzdFV0aWxzLnNldE9wdGlvbnNVc2luZ1ZhbHVlcyhsaXN0LCBmaWVsZEtleSwga2V5TWFwLCByZWxhb2RBbGwsIHJlY29yZCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZC5zZWFyY2gpICYmICFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eShjcnVkLnNlYXJjaC5mb3JtKSkgIHtcbiAgICAgIEZvcm1VdGlscy5zZXRPcHRpb25zVXNpbmdWYWx1ZXMoY3J1ZC5zZWFyY2guZm9ybSwgZmllbGRLZXksIGtleU1hcCwgcmVsYW9kQWxsLCByZWNvcmQpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBzZXREaXNwbGF5VHlwZShjcnVkVGFiczogQXJyYXk8Q3J1ZFRhYj4sIGZvcm1EaXNwbGF5TW9kZTogRm9ybURpYXBseU1vZGUpIHtcbiAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KGNydWRUYWJzKSkge1xuICAgICAgY3J1ZFRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgICAgICBpZiAoIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYikgJiYgIUNvbGxlY3Rpb25VdGlscy5pc0VtcHR5KHRhYi53aWRnZXRzKSkge1xuICAgICAgICAgIHRhYi53aWRnZXRzLmZvckVhY2god2lkZ2V0ID0+IHtcbiAgICAgICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkod2lkZ2V0KSAmJiB3aWRnZXQud2lkZ2V0VHlwZSA9PSBDcnVkV2lkZ2V0VHlwZS5GT1JNKSB7XG4gICAgICAgICAgICAgICg8Rm9ybT53aWRnZXQud2lkZ2V0KS5kaXNwbGF5TW9kZSA9IGZvcm1EaXNwbGF5TW9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBjaGFuZ2VCdXR0b25MYWJlbEljb24oY3J1ZFRhYnM6IEFycmF5PENydWRUYWI+LCBidXR0b25JZGVudGlmaWVyOiBzdHJpbmcsIGxhYmVsPzogc3RyaW5nLCBpY29uPzogc3RyaW5nKSAge1xuICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkoY3J1ZFRhYnMpKSB7XG4gICAgICBjcnVkVGFicy5mb3JFYWNoKHRhYiA9PiB7XG4gICAgICAgIGlmICghQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkodGFiKSAmJiAhQ29sbGVjdGlvblV0aWxzLmlzRW1wdHkodGFiLndpZGdldHMpKSB7XG4gICAgICAgICAgdGFiLndpZGdldHMuZm9yRWFjaCh3aWRnZXQgPT4ge1xuICAgICAgICAgICAgaWYgKCFDb2xsZWN0aW9uVXRpbHMuaXNFbXB0eSh3aWRnZXQpICYmIHdpZGdldC53aWRnZXRUeXBlID09IENydWRXaWRnZXRUeXBlLkZPUk0pIHtcbiAgICAgICAgICAgICAgRm9ybVV0aWxzLmNoYW5nZUJ1dHRvbkxhYmVsSWNvbigoPEZvcm0+d2lkZ2V0LndpZGdldCksIGJ1dHRvbklkZW50aWZpZXIsIGxhYmVsLCBpY29uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxufSJdfQ==